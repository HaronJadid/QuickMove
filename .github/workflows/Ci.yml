name: CI Pipeline

# Trigger on Pull Requests to main
on:
  pull_request:
    branches: [ main ]

jobs:
  # JOB 1: Test the Backend
  backend-checks:
    runs-on: ubuntu-latest
    defaults:
      run:
        working-directory: ./backend # Important: cd into backend
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'
          cache-dependency-path: backend/package-lock.json

      - name: Install Backend Dependencies
        run: npm ci # 'ci' is faster/cleaner than 'install' for pipelines

      - name: Run Backend Tests
        # Only run this if you actually wrote tests. If not, comment it out.
        run: npm test --if-present 

  # JOB 2: Test the Frontend
  frontend-checks:
    runs-on: ubuntu-latest
    defaults:
      run:
        working-directory: ./frontend # Important: cd into frontend
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'
          cache-dependency-path: frontend/package-lock.json

      - name: Install Frontend Dependencies
        run: npm ci

      - name: Check for Build Errors
        # This tries to build the React app. If it fails, the PR is blocked.
        run: npm run build